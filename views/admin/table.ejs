<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/adminTable.css">
</head>
<style>

    body {
    display: flex;
    min-height: 100vh;
    margin: 0;
    background-color: #f1f1f1;
}

.sidebar {
    position: fixed;
    top: 0;
    left: 0;
    width: 250px;
    height: 100vh;
    background-color: #f8f9fa;
    padding: 5px;
    box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
    align-items: center;
    overflow: hidden; 
    z-index: 1000;
}

.sidebar img {
    width: 100px;
    height: 100px;
    border-radius: 50%;
}

.sidebar nav {
    display: flex;
    flex-direction: column;
    width: 100%;
    align-items: center;
}

.sidebar nav a {
    padding: 10px 20px;
    color: #000;
    text-decoration: none;
    border-radius: 10px;
    margin-bottom: 10px;
    transition: background 0.5s ease;
    width: 90%;
}

.sidebar nav a.active,
.sidebar nav a:hover {
    background: #5e5e5e;
    color: #fff;
}

.sidebar button {
    width: 100%;
    padding: 10px;
    border: none;
    border-radius: 10px;
    color: #fff;
    background: #5e5e5e;
    cursor: pointer;
    margin-top: auto;
}

.main-content {
    margin-left: 250px; 
    flex-grow: 1;
    padding: 0;
    display: flex;
    flex-direction: column;
}

.navbar-custom-wrapper {
    display: flex;
    justify-content: center;
    margin-bottom: 20px;
}

.navbar-custom {
    background-color: #ffffff;
    border-bottom-left-radius: 20px;
    border-bottom-right-radius: 20px;
    width: 95%;
    max-width: 1200px;
    padding: 0.5rem 1.5rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.navbar-custom img {
    width: 40px;
    height: 40px;
    object-fit: cover;
    border: 1px solid black;
}

.navbar-custom .admin-info {
    line-height: 1.2;
}

.navbar-custom .admin-info .fw-semibold {
    font-size: 1rem;
    color: #343a40;
}

.navbar-custom .admin-info p {
    margin: 0;
    font-size: 0.875rem;
    color: #6c757d;
}

.navbar-custom .btn-danger {
    padding: 0.4rem 0.6rem;
}

.container-fluid {
    padding: 2rem;
}
  .table-card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  .table-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.12);
  }
</style>
<body>

  <div class="sidebar" id="sidebar">
    <div class="d-flex justify-content-center mb-5 mt-3">
    <img src="<%= settings.logo ? settings.logo : '/images/napslogo.png' %>" alt="Logo" width="150" />
    </div>
     <nav>
    <a href="/admin/index"><i class="bi bi-speedometer2"></i> Dashboard</a>
    <a href="/admin/users"><i class="bi bi-person-circle"></i> Users Profile</a>
    <a href="/admin/staff"><i class="bi bi-people-fill"></i> Account Creation</a>
    <a href="/admin/orders"><i class="bi bi-receipt"></i> Orders</a>
    <a href="/admin/reservations"><i class="bi bi-journal-bookmark"></i> Reservations</a>
    <a href="/admin/discounts"><i class="bi bi-percent"></i> Product Discounts</a>
    <a href="/admin/reviews"><i class="bi bi-chat-dots"></i> Users Reviews</a>
    <a href="/admin/products" ><i class="bi bi-box-seam"></i> Inventory</a>
    <a href="/admin/table"class="active"><i class="bi bi-table"></i> Table</a>
    <a href="/admin/calendar"><i class="bi bi-calendar-event"></i> Calendar</a>
    <a href="/admin/settings" ><i class="bi bi-gear"></i> Settings</a>
  </nav>

  
</div>

  <div class="main-content">
    <div class="navbar-custom-wrapper">
      <nav class="navbar navbar-custom d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center">
          <img src="/images/admin-avatar.avif" alt="Admin" class="rounded-circle me-3">
          <div class="admin-info">
            <div class="fw-semibold">Super Admin</div>
            <p>napsgrillrestobar08@gmail.com</p>
          </div>
        </div>

      <a href="/logout" class="btn btn-sm btn-danger d-flex align-items-center">
        <i class="bi bi-box-arrow-right me-1"></i> Logout
      </a>
      </nav>
    </div>

<div class="container-fluid">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4 px-3">
    <h2 class="fw-bold mb-0" style="color: #333446;">Manage Tables</h2>
    <button class="btn text-white fw-semibold shadow-sm px-3 py-2" 
            style="background:  #006aff; border-radius: 8px;"
            data-bs-toggle="modal" data-bs-target="#addTableModal">
      <i class="bi bi-plus-circle me-2"></i> Add Table
    </button>
  </div>

  <!-- Tables Grid -->
  <div class="row mt-4">
    <% if (tables.length > 0) { %>
      <% tables.forEach((table) => { %>
        <div class="col-md-4 mb-4">
          <div class="card h-100 shadow-sm border-0 rounded-4 table-card">
            <img src="/uploads/<%= table.image %>" class="card-img-top rounded-top-4"
                 style="height: 200px; object-fit: cover;" alt="Table Image">
            
            <div class="card-body text-center">
              <h5 class="fw-bold text-dark mb-2"><%= table.name %></h5>
              <p class="text-muted small mb-2"><%= table.description %></p>
              <p class="fw-semibold text-success mb-1">â‚±<%= table.price %></p>
              <p class="fw-semibold text-primary mb-1">Reservation Fee: â‚±<%= table.reservation_fee %></p>
              <span class="badge bg-secondary px-3 py-2"><%= table.pax %> Pax</span>
            </div>

            <div class="card-footer d-flex justify-content-center gap-2 bg-light rounded-bottom-4">
              <button class="btn btn-sm text-white shadow-sm"
                      style="background: #006aff; border-radius: 6px;"
                      data-bs-toggle="modal" data-bs-target="#editModal-<%= table._id %>">
                <i class="bi bi-pencil-square"></i>
              </button>
              <form onsubmit="return confirmDelete(event, '<%= table._id %>')" class="d-inline">
                <button type="submit" class="btn btn-sm text-white shadow-sm"
                        style="background: linear-gradient(90deg, #FF3E3E, #D10000); border-radius: 6px;">
                  <i class="bi bi-trash"></i>
                </button>
              </form>
            </div>
          </div>
        </div>

        <div class="modal fade" id="editModal-<%= table._id %>" tabindex="-1">
          <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content rounded-4">
              <form action="/admin/table/edit/<%= table._id %>" method="POST" enctype="multipart/form-data">
                <div class="modal-header text-black" 
                     style="background: rgb(218, 218, 218); border-radius: 12px 12px 0 0;">
                  <h5 class="modal-title">Edit Table - <%= table.name %></h5>
                 <button type="button" class="btn-close" style="filter: invert(0);" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body row g-3 px-3">
                  <div class="col-md-6">
                    <label class="form-label"><i class="bi bi-table"></i> Table Name</label>
                    <input type="text" name="name" class="form-control" maxlength="40" value="<%= table.name %>" required>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label"><i class="bi bi-currency-dollar"></i> Price</label>
                    <input type="number" name="price" class="form-control" value="<%= table.price %>" min="1" max="100000" required oninput="this.value = Math.abs(this.value)">
                  </div>
                  <div class="col-md-6">
                    <label class="form-label"><i class="bi bi-currency-dollar"></i> Reservation Fee</label>
                    <input type="number" name="reservation_fee" class="form-control" value="<%= table.reservation_fee %>" min="1" max="100000" required oninput="this.value = Math.abs(this.value)">
                  </div>
                  <div class="col-md-6">
                    <label class="form-label"><i class="bi bi-person-plus-fill"></i> Pax</label>
                    <input type="number" name="pax" class="form-control" value="<%= table.pax %>" min="0" max="100" required oninput="this.value = Math.abs(this.value)">
                  </div>
                  <div class="col-md-6">
                    <label class="form-label"><i class="bi bi-file-image-fill"></i> Image (Leave blank to keep current)</label>
                    <input type="file" name="image" class="form-control" accept="image/*">
                  </div>
                  <div class="col-12">
                    <label class="form-label"><i class="bi bi-body-text"></i> Description</label>
                    <textarea name="description" class="form-control" maxlength="100" rows="3" required><%= table.description %></textarea>
                  </div>
                </div>

                <div class="modal-footer">
                  <button type="submit" class="btn text-white fw-semibold px-4" style="background: rgb(14, 83, 231);"><i class="bi bi-plus-circle"></i> Update</button>
                  <button type="button" class="btn btn-danger px-4" data-bs-dismiss="modal"><i class="bi bi-x-lg"></i> Cancel</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      <% }) %>
    <% } else { %>
      <div class="col-12">
        <div class="alert alert-info text-center shadow-sm">No tables found.</div>
      </div>
    <% } %>
  </div>
</div>

<div class="modal fade" id="addTableModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content rounded-4">
      <form action="/admin/table/create" method="POST" enctype="multipart/form-data">
        <div class="modal-header text-black"
             style="background: rgb(218, 218, 218); border-radius: 12px 12px 0 0;">
          <h5 class="modal-title">Add New Table</h5>
         <button type="button" class="btn-close" style="filter: invert(0);" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body row g-3 px-3">
          <div class="col-md-6">
            <label class="form-label"><i class="bi bi-table"></i> Table Name</label>
            <input type="text" name="name" class="form-control" placeholder="Enter Table Name..." required>
          </div>
          <div class="col-md-6">
            <label class="form-label"><i class="bi bi-currency-dollar"></i> Price</label>
            <input type="number" name="price" class="form-control" placeholder="Enter Table Price..." min="1"  max="1000000"  required oninput="this.value = Math.abs(this.value)"
>
          </div>
          <div class="col-md-6">
            <label class="form-label"><i class="bi bi-currency-dollar"></i> Reservation Fee</label>
            <input type="number" name="reservation_fee" class="form-control"max="1000000" placeholder="Enter Table Reservation Fee..." min="1" required oninput="this.value = Math.abs(this.value)"
>
          </div>
          <div class="col-md-6">
            <label class="form-label"><i class="bi bi-person-plus-fill"></i> Pax</label>
            <input type="number" name="pax" class="form-control" placeholder="Enter Table Pax..." min="1" required oninput="this.value = Math.abs(this.value)"
>
          </div>
          <div class="col-md-6">
            <label class="form-label"><i class="bi bi-file-image-fill"></i> Image</label>
            <input type="file" name="image" class="form-control" accept="image/*" required>
          </div>
          <div class="col-12">
            <label class="form-label"><i class="bi bi-body-text"></i> Description</label>
            <textarea name="description" maxlength="100" class="form-control" rows="3" placeholder="Enter Description..." required></textarea>
          </div>
        </div>

        <div class="modal-footer">
          <button type="submit" class="btn text-white fw-semibold px-4" style="background: rgb(14, 83, 231);"><i class="bi bi-plus-circle"></i> Add Table</button>
          <button type="button" class="btn btn-danger px-4" data-bs-dismiss="modal"><i class="bi bi-x-lg"></i> Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>




  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <% if (typeof success !== 'undefined' && success) { %>
    
    <% } %>

    <script>
    function confirmDelete(event, tableId) {
        event.preventDefault();
        Swal.fire({
        title: 'Are you sure?',
        text: "This table will be deleted!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#6c757d',
        confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
        if (result.isConfirmed) {
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = `/admin/table/delete/${tableId}`;
            document.body.appendChild(form);
            form.submit();
        }
        });
        return false;
    }
  document.addEventListener("DOMContentLoaded", () => {
    const addTableForm = document.querySelector('#addTableModal form');
    if (!addTableForm) return;

    const existingTables = JSON.parse('<%- JSON.stringify(tables.map(t => t.name.toLowerCase())) %>');

    addTableForm.addEventListener("submit", (e) => {
      const nameInput = addTableForm.querySelector('input[name="name"]');
      const enteredName = nameInput.value.trim().toLowerCase();

      if (existingTables.includes(enteredName)) {
        e.preventDefault();
        Swal.fire({
          icon: 'warning',
          title: 'Duplicate Table Name',
          text: 'A table with this name already exists!',
          confirmButtonColor: '#006aff'
        });
      }
    });
  });
</script>

<script>
document.addEventListener("DOMContentLoaded", function () {

  // Select all inputs and textareas in add/edit modals
  const fields = document.querySelectorAll(
    '#addTableModal input, #addTableModal textarea, [id^="editModal-"] input, [id^="editModal-"] textarea'
  );

  fields.forEach(field => {
    field.addEventListener("input", function () {
      const name = this.getAttribute("name");
      const type = this.getAttribute("type");
      const maxLength = this.getAttribute("maxlength");
      const maxValue = this.getAttribute("max");
      const value = this.value;

      // ðŸ”¸ Maxlength for text/textarea
      if (maxLength && value.length >= parseInt(maxLength)) {
        this.value = value.substring(0, parseInt(maxLength));
        Swal.fire({
          icon: "warning",
          title: "Maximum Text Limit Reached",
          text: `You can only enter up to ${maxLength} characters.`,
          showConfirmButton: false,
          timer: 1000,
          timerProgressBar: true
        });
      }

      if (type === "number" && maxValue && parseFloat(value) > parseFloat(maxValue)) {
        this.value = maxValue;
        Swal.fire({
          icon: "warning",
          title: "Maximum Value Reached",
          text: `You cannot enter more than ${maxValue}.`,
          showConfirmButton: false,
          timer: 1000,
          timerProgressBar: true
        });
      }

      if (name === "name" && value.length > 40) {
        this.value = value.substring(0, 40);
        Swal.fire({
          icon: "warning",
          title: "Table Name Too Long",
          text: "Table name can only have up to 40 characters.",
          showConfirmButton: false,
          timer: 1500,
          timerProgressBar: true
        });
      }

      if (name === "pax" && parseInt(value) > 100) {
        this.value = 100;
        Swal.fire({
          icon: "warning",
          title: "Maximum Pax Limit Reached",
          text: "Pax cannot exceed 100.",
          showConfirmButton: false,
          timer: 1500,
          timerProgressBar: true
        });
      }
    });
  });

  const imageInputs = document.querySelectorAll('input[type="file"][name="image"]');
  imageInputs.forEach(input => {
    input.addEventListener("change", function () {
      const file = this.files[0];
      if (file) {
        const validTypes = ["image/jpeg", "image/png", "image/jpg"];
        if (!validTypes.includes(file.type)) {
          this.value = "";
          Swal.fire({
            icon: "error",
            title: "Invalid File Type",
            text: "Please upload only JPG, JPEG, or PNG images.",
            showConfirmButton: false,
            timer: 1500,
            timerProgressBar: true
          });
        }
      }
    });
  });

});
</script>
<script>
  document.querySelectorAll('input[name="name"]').forEach(input => {
    input.addEventListener('input', function () {
      let value = this.value;

      // Allow only letters and spaces
      const regex = /^[A-Za-z\s]*$/;
      if (!regex.test(value)) {
        this.value = value.replace(/[^A-Za-z\s]/g, '');
        Swal.fire({
          icon: 'warning',
          title: 'Invalid Input',
          text: 'Only letters and spaces are allowed.',
          showConfirmButton: false,
          timer: 1500,
          timerProgressBar: true,
          position: 'center'
        });
        return;
      }

      // Prevent input with spaces only
      if (value.trim() === '' && value.length > 0) {
        this.value = '';
        Swal.fire({
          icon: 'warning',
          title: 'Invalid Input',
          text: 'Name cannot contain only spaces.',
          showConfirmButton: false,
          timer: 1500,
          timerProgressBar: true,
          position: 'center'
        });
        return;
      }

      // Maximum 40 characters check
      if (value.length > 40) {
        this.value = value.substring(0, 40);
        Swal.fire({
          icon: 'info',
          title: 'Maximum Length Reached',
          text: 'Name can only have up to 40 characters.',
          showConfirmButton: false,
          timer: 1500,
          timerProgressBar: true,
          position: 'center'
        });
      }
    });
  });
</script>

</body>
</html>
