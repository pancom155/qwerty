<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/adminTable.css">
</head>
<style>

    body {
    display: flex;
    min-height: 100vh;
    margin: 0;
    background-color: #f1f1f1;
}

.sidebar {
    position: fixed;
    top: 0;
    left: 0;
    width: 250px;
    height: 100vh;
    background-color: #f8f9fa;
    padding: 5px;
    box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
    align-items: center;
    overflow: hidden; 
    z-index: 1000;
}

.sidebar img {
    width: 100px;
    height: 100px;
    border-radius: 50%;
}

.sidebar nav {
    display: flex;
    flex-direction: column;
    width: 100%;
    align-items: center;
}

.sidebar nav a {
    padding: 10px 20px;
    color: #000;
    text-decoration: none;
    border-radius: 10px;
    margin-bottom: 10px;
    transition: background 0.5s ease;
    width: 90%;
}

.sidebar nav a.active,
.sidebar nav a:hover {
    background: linear-gradient(90deg, #03C4E7, #0047FF);
    color: #fff;
}

.sidebar button {
    width: 100%;
    padding: 10px;
    border: none;
    border-radius: 10px;
    color: #fff;
    background: linear-gradient(90deg, #03C4E7, #0047FF);
    cursor: pointer;
    margin-top: auto;
}

.main-content {
    margin-left: 250px; 
    flex-grow: 1;
    padding: 0;
    display: flex;
    flex-direction: column;
}

.navbar-custom-wrapper {
    display: flex;
    justify-content: center;
    margin-bottom: 20px;
}

.navbar-custom {
    background-color: #ffffff;
    border-bottom-left-radius: 20px;
    border-bottom-right-radius: 20px;
    width: 95%;
    max-width: 1200px;
    padding: 0.5rem 1.5rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.navbar-custom img {
    width: 40px;
    height: 40px;
    object-fit: cover;
    border: 1px solid black;
}

.navbar-custom .admin-info {
    line-height: 1.2;
}

.navbar-custom .admin-info .fw-semibold {
    font-size: 1rem;
    color: #343a40;
}

.navbar-custom .admin-info p {
    margin: 0;
    font-size: 0.875rem;
    color: #6c757d;
}

.navbar-custom .btn-danger {
    padding: 0.4rem 0.6rem;
}

.container-fluid {
    padding: 2rem;
}
  .table-card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  .table-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.12);
  }
</style>
<body>

  <div class="sidebar" id="sidebar">
    <div class="d-flex justify-content-center mb-5 mt-3">
    <img src="<%= settings.logo ? settings.logo : '/images/napslogo.png' %>" alt="Logo" width="150" />
    </div>
     <nav>
    <a href="/admin/index"><i class="bi bi-speedometer2"></i> Dashboard</a>
    <a href="/admin/users"><i class="bi bi-person-circle"></i> Users Profile</a>
    <a href="/admin/staff"><i class="bi bi-people-fill"></i> Account Creation</a>
    <a href="/admin/orders"><i class="bi bi-receipt"></i> Orders</a>
    <a href="/admin/reservations"><i class="bi bi-journal-bookmark"></i> Reservations</a>
    <a href="/admin/discounts"><i class="bi bi-percent"></i> Discounts</a>
    <a href="/admin/reviews"><i class="bi bi-chat-dots"></i> Users Reviews</a>
    <a href="/admin/products" ><i class="bi bi-box-seam"></i> Inventory</a>
    <a href="/admin/table"class="active"><i class="bi bi-table"></i> Table</a>
      <a href="/admin/calendar"><i class="bi bi-calendar-event"></i> Calendar</a>
  <a href="/admin/settings" ><i class="bi bi-gear"></i> Settings</a>
  </nav>
  </div>

  <div class="main-content">
    <div class="navbar-custom-wrapper">
      <nav class="navbar navbar-custom d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center">
          <img src="/images/admin-avatar.avif" alt="Admin" class="rounded-circle me-3">
          <div class="admin-info">
            <div class="fw-semibold">Super Admin</div>
            <p>napsgrillrestobar08@gmail.com</p>
          </div>
        </div>

        <a href="/logout" class="btn btn-sm btn-danger d-flex align-items-center">
          <i class="bi bi-box-arrow-right"></i>
        </a>
      </nav>
    </div>

<div class="container-fluid">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4 px-3">
    <h1 class="fw-bold mb-0" style="color: #333446;">Manage Tables</h1>
    <button class="btn text-white fw-semibold shadow-sm px-3 py-2" 
            style="background: linear-gradient(90deg, #03C4E7, #0047FF); border-radius: 8px;"
            data-bs-toggle="modal" data-bs-target="#addTableModal">
      <i class="bi bi-plus-circle me-2"></i> Add Table
    </button>
  </div>

  <!-- Tables Grid -->
  <div class="row mt-4">
    <% if (tables.length > 0) { %>
      <% tables.forEach((table) => { %>
        <div class="col-md-4 mb-4">
          <div class="card h-100 shadow-sm border-0 rounded-4 table-card">
            <img src="/uploads/<%= table.image %>" class="card-img-top rounded-top-4"
                 style="height: 200px; object-fit: cover;" alt="Table Image">
            
            <div class="card-body text-center">
              <h5 class="fw-bold text-dark mb-2"><%= table.name %></h5>
              <p class="text-muted small mb-2"><%= table.description %></p>
              <p class="fw-semibold text-success mb-1">₱<%= table.price %></p>
              <p class="fw-semibold text-primary mb-1">Reservation Fee: ₱<%= table.reservation_fee %></p>
              <span class="badge bg-secondary px-3 py-2"><%= table.pax %> Pax</span>
            </div>

            <div class="card-footer d-flex justify-content-center gap-2 bg-light rounded-bottom-4">
              <button class="btn btn-sm text-white shadow-sm"
                      style="background: linear-gradient(90deg, #03C4E7, #0047FF); border-radius: 6px;"
                      data-bs-toggle="modal" data-bs-target="#editModal-<%= table._id %>">
                <i class="bi bi-pencil-square"></i>
              </button>
              <form onsubmit="return confirmDelete(event, '<%= table._id %>')" class="d-inline">
                <button type="submit" class="btn btn-sm text-white shadow-sm"
                        style="background: linear-gradient(90deg, #FF3E3E, #D10000); border-radius: 6px;">
                  <i class="bi bi-trash"></i>
                </button>
              </form>
            </div>
          </div>
        </div>

        <!-- Edit Modal -->
        <div class="modal fade" id="editModal-<%= table._id %>" tabindex="-1">
          <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content rounded-4">
              <form action="/admin/table/edit/<%= table._id %>" method="POST" enctype="multipart/form-data">
                <div class="modal-header text-white" 
                     style="background: linear-gradient(90deg, #03C4E7, #0047FF); border-radius: 12px 12px 0 0;">
                  <h5 class="modal-title">Edit Table - <%= table.name %></h5>
                  <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body row g-3 px-3">
                  <div class="col-md-6">
                    <label class="form-label">Name</label>
                    <input type="text" name="name" class="form-control" value="<%= table.name %>" required>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">Price</label>
                    <input type="number" name="price" class="form-control" value="<%= table.price %>" required>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">Reservation Fee</label>
                    <input type="number" name="reservation_fee" class="form-control" value="<%= table.reservation_fee %>" required>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">Pax</label>
                    <input type="number" name="pax" class="form-control" value="<%= table.pax %>" required>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">Image (Leave blank to keep current)</label>
                    <input type="file" name="image" class="form-control" accept="image/*">
                  </div>
                  <div class="col-12">
                    <label class="form-label">Description</label>
                    <textarea name="description" class="form-control" rows="3" required><%= table.description %></textarea>
                  </div>
                </div>

                <div class="modal-footer">
                  <button type="submit" class="btn text-white fw-semibold px-4"
                          style="background: linear-gradient(90deg, #03C4E7, #0047FF);">
                    Update
                  </button>
                  <button type="button" class="btn btn-secondary px-4" data-bs-dismiss="modal">Cancel</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      <% }) %>
    <% } else { %>
      <div class="col-12">
        <div class="alert alert-info text-center shadow-sm">No tables found.</div>
      </div>
    <% } %>
  </div>
</div>

<!-- Add Table Modal -->
<div class="modal fade" id="addTableModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content rounded-4">
      <form action="/admin/table/create" method="POST" enctype="multipart/form-data">
        <div class="modal-header text-white"
             style="background: linear-gradient(90deg, #03C4E7, #0047FF); border-radius: 12px 12px 0 0;">
          <h5 class="modal-title">Add New Table</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body row g-3 px-3">
          <div class="col-md-6">
            <label class="form-label">Name</label>
            <input type="text" name="name" class="form-control" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">Price</label>
            <input type="number" name="price" class="form-control" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">Reservation Fee</label>
            <input type="number" name="reservation_fee" class="form-control" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">Pax</label>
            <input type="number" name="pax" class="form-control" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">Image</label>
            <input type="file" name="image" class="form-control" accept="image/*" required>
          </div>
          <div class="col-12">
            <label class="form-label">Description</label>
            <textarea name="description" class="form-control" rows="3" required></textarea>
          </div>
        </div>

        <div class="modal-footer">
          <button type="submit" class="btn text-white fw-semibold px-4"
                  style="background: linear-gradient(90deg, #03C4E7, #0047FF);">
            Add Table
          </button>
          <button type="button" class="btn btn-secondary px-4" data-bs-dismiss="modal">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>




  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <% if (typeof success !== 'undefined' && success) { %>
    
    <% } %>

    <script>
    function confirmDelete(event, tableId) {
        event.preventDefault();
        Swal.fire({
        title: 'Are you sure?',
        text: "This table will be deleted!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#6c757d',
        confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
        if (result.isConfirmed) {
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = `/admin/table/delete/${tableId}`;
            document.body.appendChild(form);
            form.submit();
        }
        });
        return false;
    }
    </script>
</body>
</html>
