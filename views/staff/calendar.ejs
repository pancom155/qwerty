<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Staff Dashboard | Calendar</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/StaffOrder.css">

  <!-- ✅ FullCalendar CSS -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>

<div class="sidebar" id="sidebar">
  <div class="d-flex justify-content-center mb-5 mt-3">
    <img src="<%= settings.logo ? settings.logo : '/images/napslogo.png' %>" alt="Logo" width="150" />
  </div>
  <nav>
    <a href="/staff/index"><i class="bi bi-speedometer2"></i> Dashboard</a>
    <a href="/staff/order"><i class="bi bi-bag-check"></i> Orders</a>
    <a href="/staff/reservation"><i class="bi bi-calendar-check"></i> Reservation</a>
    <a href="/staff/calendar" class="active"><i class="bi bi-calendar-check"></i> Calendar</a>
      
  </nav>
</div>

<div class="main-content">
  <div class="navbar-custom-wrapper">
    <nav class="navbar navbar-custom d-flex justify-content-between align-items-center">
      <div class="d-flex align-items-center">
        <img src="/images/admin-avatar.avif" alt="Admin" class="rounded-circle me-3">
        <div class="admin-info">
          <div class="fw-semibold mb-1"><%= user.fullName %></div>
          <p><%= user.email %></p>
        </div>
      </div>

      <a href="/logout" class="btn btn-sm btn-danger d-flex align-items-center">
        <i class="bi bi-box-arrow-right"></i> Logout
      </a>
    </nav>
  </div>

  <div class="container-fluid mt-4">
    <h3 class="mb-4">Calendar</h3>

    <!-- ✅ Calendar Container -->
    <div id="calendar"></div>
  </div>
</div>
<!-- Reservation Details Modal -->
<div class="modal fade" id="reservationModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content shadow-lg border-0 rounded-3">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title"><i class="bi bi-calendar-event me-2"></i> Reservation Details</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <div class="row g-3">
          <!-- User Info -->
          <div class="col-md-6">
            <div class="card shadow-sm border-0">
              <div class="card-body">
                <h6 class="fw-bold mb-3"><i class="bi bi-person-circle me-2"></i>User Information</h6>
                <p class="mb-1"><strong>Full Name:</strong> <span id="resFullName"></span></p>
                <p class="mb-1"><strong>Email:</strong> <span id="resEmail"></span></p>
                <p class="mb-0"><strong>Phone:</strong> <span id="resPhone"></span></p>
              </div>
            </div>
          </div>

          <!-- Reservation Info -->
          <div class="col-md-6">
            <div class="card shadow-sm border-0">
              <div class="card-body">
                <h6 class="fw-bold mb-3"><i class="bi bi-info-circle me-2"></i>Reservation Info</h6>
                <p class="mb-1"><strong>Table:</strong> <span id="resTable"></span></p>
                <p class="mb-1"><strong>Reference No.:</strong> <span id="resRef"></span></p>
                <p class="mb-1"><strong>Total Price:</strong> ₱<span id="resPrice"></span></p>
                <p class="mb-1"><strong>Reservation Fee:</strong> ₱<span id="resFee"></span></p>
                <p class="mb-0"><strong>Status:</strong> 
                  <span id="resStatus" class="badge bg-warning text-dark px-3 py-2 rounded-pill"></span>
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>


<!-- ✅ Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    var calendarEl = document.getElementById('calendar');

    var calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      themeSystem: 'bootstrap5',
      height: 'auto',
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,timeGridDay'
      },

      // ✅ Load events dynamically from backend
      events: '/staff/calendar/events',

      // ✅ Show reservation modal on click
      eventClick: function (info) {
        const props = info.event.extendedProps;

        document.getElementById('resFullName').innerText = props.fullName;
        document.getElementById('resEmail').innerText = props.email;
        document.getElementById('resPhone').innerText = props.phone;
        document.getElementById('resTable').innerText = props.table;
        document.getElementById('resRef').innerText = props.refNo;
        document.getElementById('resPrice').innerText = props.price;
        document.getElementById('resFee').innerText = props.fee;
        document.getElementById('resStatus').innerText = props.status;
       

        var modal = new bootstrap.Modal(document.getElementById('reservationModal'));
        modal.show();
      },

      // ✅ Optional: Add new event on date click
      dateClick: function (info) {
        Swal.fire({
          title: 'New Event',
          text: `You clicked on ${info.dateStr}`,
          input: 'text',
          inputPlaceholder: 'Enter event title',
          showCancelButton: true,
          confirmButtonText: 'Add Event'
        }).then((result) => {
          if (result.isConfirmed && result.value) {
            calendar.addEvent({
              title: result.value,
              start: info.dateStr,
              allDay: true
            });
            Swal.fire('Added!', 'Your event has been added.', 'success');
          }
        });
      }
    });

    calendar.render();
  });
</script>

</body>
</html>
